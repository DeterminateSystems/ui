import type { FC } from "react";

import "./index.scss";
import Link from "../Link";

export type CVSSVectorProps = {
  note?: string;
  vector: string;
};

export type VulnerabilityPropertiesProps = {
  vectors?: CVSSVectorProps[];
  cve_ids?: string[];
  references?: string[];
};

const VulnerabilityProperties: FC<VulnerabilityPropertiesProps> = ({
  vectors,
  cve_ids,
  references,
}) => (
  <VulnerabilityPropertyContainer>
    {vectors != undefined && vectors.length > 0 && (
      <VulnerabilityVectorsProperty vectors={vectors} />
    )}
    {cve_ids != undefined && cve_ids.length > 0 && (
      <VulnerabilityCVEProperty ids={cve_ids} />
    )}
    {references != undefined && references.length > 0 && (
      <VulnerabilityReferencesProperty urls={references} />
    )}
  </VulnerabilityPropertyContainer>
);

const VulnerabilityPropertyContainer: FC<React.PropsWithChildren> = ({
  children,
}) => <dl className="vulnerability-properties">{children}</dl>;

const VulnerabilityVectorsProperty: FC<{ vectors: CVSSVectorProps[] }> = ({
  vectors,
}) => (
  <>
    <dt>CVSS Vector{vectors.length > 1 && "s"}</dt>
    <dd>
      <CVSSVectors vectors={vectors} />
    </dd>
  </>
);

const CVSSVectors: FC<{ vectors: CVSSVectorProps[] }> = ({ vectors }) => (
  <div className="cvss-vectors">
    {vectors.map((vector) => (
      <CVSSVector note={vector.note} vector={vector.vector} />
    ))}
  </div>
);

const CVSSVector: FC<CVSSVectorProps> = ({ note, vector }) => (
  <>
    <span className="cvss-vector--note">
      {note != undefined && note.length > 0 && note}
    </span>
    <span className="cvss-vector--vector">{vector}</span>
  </>
);

const VulnerabilityCVEProperty: FC<{ ids: string[] }> = ({ ids }) => (
  <>
    <dt>Related CVEs</dt>
    {ids.map((id) => (
      <dd>{id}</dd>
    ))}
  </>
);

const VulnerabilityReferencesProperty: FC<{ urls: string[] }> = ({ urls }) => (
  <>
    <dt>External references</dt>
    {urls.map((url) => (
      <dd className="vulnerability-references-property--url">
        <Link href={url}>{url}</Link>
      </dd>
    ))}
  </>
);

export default VulnerabilityProperties;
